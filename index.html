<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CV Creator Platinum - Generatore PDF</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font & Icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;600;700&family=Merriweather:wght@300;400;700&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">

    <!-- Configurazione Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                        mono: ['Roboto Mono', 'monospace'],
                        poppins: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: 'var(--color-primary)',
                        'side-bg': 'var(--color-side-bg)',
                        'side-text': 'var(--color-side-text)',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- STILI GLOBALI --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #0f172a; /* Sfondo scuro per l'app */
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* App-like feel */
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            box-sizing: border-box;
        }

        /* Scrollbar personalizzata */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* --- FOGLIO A4 (Target) --- */
        #cv-render-target {
            width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transform-origin: top center;
            transition: transform 0.2s ease;
            position: relative;
            margin-bottom: 50px; /* Spazio per lo scroll */
        }
        
        /* Variabili CSS Dinamiche */
        .cv-page {
            color: var(--color-text, #1e293b);
            line-height: 1.5;
        }
        
        /* --- REGOLE DI STAMPA CRITICHE (FIX PDF BIANCO) --- */
        @media print {
            /* 1. Nascondi TUTTO */
            body * {
                visibility: hidden;
            }

            /* 2. Resetta contenitori principali */
            body, html, .app-container, #preview-container {
                background: white !important;
                height: auto !important;
                width: 100% !important;
                overflow: visible !important;
                position: static !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 3. Rendi visibile SOLO il CV e i suoi figli */
            #cv-render-target, #cv-render-target * {
                visibility: visible;
            }

            /* 4. Posiziona il CV in alto a sinistra assoluto */
            #cv-render-target {
                position: fixed;
                left: 0;
                top: 0;
                width: 210mm !important;
                min-height: 297mm !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                transform: none !important; /* Disabilita lo zoom JS */
                z-index: 9999;
                
                /* 5. Forza la stampa di sfondi e colori */
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background-color: white !important;
            }

            /* 6. Impostazioni Pagina */
            @page {
                margin: 0;
                size: A4;
            }
        }
    </style>
</head>
<body>

<div id="cv-app-root" class="app-container">
    
    <!-- EDITOR (SINISTRA) -->
    <div class="w-full md:w-[420px] bg-slate-900 border-r border-slate-700 flex-shrink-0 flex flex-col z-20 print-hidden shadow-2xl">
        
        <!-- HEADER -->
        <div class="p-5 border-b border-slate-700 flex justify-between items-center bg-slate-900">
            <div class="text-white text-xl font-bold flex items-center gap-2 tracking-tight">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white shadow-lg">
                    <i class="fa-solid fa-file-contract text-sm"></i>
                </div>
                CV Platinum
            </div>
            <button onclick="cvApp.resetData()" class="text-slate-400 hover:text-white transition-colors text-sm flex items-center gap-1">
                <i class="fa-solid fa-rotate-right"></i> Reset
            </button>
        </div>

        <!-- TABS -->
        <div class="flex bg-slate-800 p-1 gap-1 mx-4 mt-4 rounded-lg">
            <button id="tab-content" onclick="cvApp.switchTab('content', this)" class="flex-1 py-2 text-sm font-medium text-white bg-slate-700 rounded shadow-sm transition-all">
                Dati
            </button>
            <button id="tab-design" onclick="cvApp.switchTab('design', this)" class="flex-1 py-2 text-sm font-medium text-slate-400 hover:text-white transition-all">
                Stile
            </button>
        </div>

        <!-- SCROLLABLE CONTENT -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-6">
            
            <!-- PANEL: CONTENT -->
            <div id="panel-content">
                
                <!-- FOTO -->
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Foto Profilo</label>
                    <div class="flex items-center gap-4">
                        <div id="preview-photo" class="w-16 h-16 rounded-full bg-slate-700 border-2 border-slate-600 flex items-center justify-center overflow-hidden shrink-0">
                            <i class="fa-solid fa-user text-slate-500 text-2xl"></i>
                        </div>
                        <div class="flex flex-col gap-2">
                            <input type="file" id="upload-photo" accept="image/*" style="display: none;" onchange="cvApp.uploadPhoto(this)">
                            <button onclick="document.getElementById('upload-photo').click()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold px-3 py-1.5 rounded transition-colors">
                                Carica Foto
                            </button>
                            <button onclick="cvApp.removePhoto()" class="text-xs text-red-400 hover:text-red-300 text-left">Rimuovi</button>
                        </div>
                    </div>
                </div>

                <!-- INFO -->
                <div class="space-y-3 mb-6">
                    <input type="text" data-model="personal.name" placeholder="Nome e Cognome" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500">
                    <input type="text" data-model="personal.title" placeholder="Titolo Professionale" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" data-model="personal.email" placeholder="Email" class="bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500">
                        <input type="text" data-model="personal.phone" placeholder="Telefono" class="bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500">
                    </div>
                    <input type="text" data-model="personal.location" placeholder="Indirizzo / Città" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500">
                </div>

                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Profilo</label>
                    <textarea data-model="personal.summary" rows="4" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500 resize-none" placeholder="Breve descrizione..."></textarea>
                </div>

                <!-- LISTE -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-xs font-bold text-slate-400 uppercase block">Esperienza</label>
                        <button onclick="cvApp.addItem('experience')" class="text-xs text-blue-400 hover:text-blue-300 font-bold">+ Aggiungi</button>
                    </div>
                    <div id="list-experience" class="space-y-3"></div>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-xs font-bold text-slate-400 uppercase block">Istruzione</label>
                        <button onclick="cvApp.addItem('education')" class="text-xs text-blue-400 hover:text-blue-300 font-bold">+ Aggiungi</button>
                    </div>
                    <div id="list-education" class="space-y-3"></div>
                </div>

                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Competenze</label>
                    <textarea data-model="skills" rows="3" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none placeholder-slate-500 resize-none" placeholder="Separale con una virgola..."></textarea>
                </div>
            </div>

            <!-- PANEL: DESIGN -->
            <div id="panel-design" style="display: none;">
                
                <!-- LAYOUT -->
                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Scegli Layout</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="cvApp.setLayout('sidebarLeft', this)" class="tpl-card active bg-slate-800 border-2 border-blue-500 rounded-lg p-3 text-center text-white hover:bg-slate-700 transition-all">
                            <div class="h-10 w-full bg-slate-700 rounded mb-2 flex overflow-hidden border border-slate-600"><div class="w-1/3 bg-slate-500 h-full"></div><div class="w-2/3 bg-transparent h-full"></div></div>
                            <span class="text-xs font-bold">Moderno</span>
                        </button>
                        <button onclick="cvApp.setLayout('classic', this)" class="tpl-card bg-slate-800 border-2 border-transparent rounded-lg p-3 text-center text-slate-400 hover:bg-slate-700 transition-all">
                            <div class="h-10 w-full bg-slate-700 rounded mb-2 flex flex-col border border-slate-600"><div class="w-full h-3 bg-slate-500 border-b border-slate-600"></div></div>
                            <span class="text-xs font-bold">Classico</span>
                        </button>
                        <button onclick="cvApp.setLayout('minimal', this)" class="tpl-card bg-slate-800 border-2 border-transparent rounded-lg p-3 text-center text-slate-400 hover:bg-slate-700 transition-all">
                            <div class="h-10 w-full bg-slate-700 rounded mb-2 flex border border-slate-600"><div class="w-full h-full border-l-4 border-slate-500 ml-2"></div></div>
                            <span class="text-xs font-bold">Minimal</span>
                        </button>
                    </div>
                </div>
                
                <!-- COLORI -->
                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Colori</label>
                    <div class="bg-slate-800 p-3 rounded-lg border border-slate-700 space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-slate-300">Colore Principale</span>
                            <div class="relative w-8 h-8 rounded-full overflow-hidden border-2 border-slate-500">
                                <input type="color" data-model="config.color" oninput="cvApp.setConfig('color', this.value)" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer">
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-slate-300">Sfondo Sidebar</span>
                            <div class="relative w-8 h-8 rounded-full overflow-hidden border-2 border-slate-500">
                                <input type="color" data-model="config.sidebarBg" oninput="cvApp.setConfig('sidebarBg', this.value)" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer">
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-slate-300">Colore Testo</span>
                            <div class="relative w-8 h-8 rounded-full overflow-hidden border-2 border-slate-500">
                                <input type="color" data-model="config.textColor" oninput="cvApp.setConfig('textColor', this.value)" class="absolute -top-2 -left-2 w-16 h-16 cursor-pointer">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TIPOGRAFIA -->
                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Carattere</label>
                    <select data-model="config.font" onchange="cvApp.setConfig('font', this.value)" class="w-full bg-slate-800 border border-slate-700 text-white rounded p-3 text-sm focus:border-blue-500 focus:outline-none">
                        <option value="Inter, sans-serif">Inter (Standard)</option>
                        <option value="Poppins, sans-serif">Poppins (Moderno)</option>
                        <option value="Merriweather, serif">Merriweather (Elegante)</option>
                        <option value="Roboto Mono, monospace">Roboto Mono (Tech)</option>
                    </select>
                </div>

                <!-- SCALA -->
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase mb-3 block flex justify-between">Dimensione Testo <span id="scale-val" class="text-blue-400">100%</span></label>
                    <input type="range" min="0.8" max="1.2" step="0.05" value="1" oninput="cvApp.setConfig('scale', this.value); document.getElementById('scale-val').innerText = Math.round(this.value*100) + '%'" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                </div>

            </div>

        </div>

        <!-- FOOTER -->
        <div class="p-4 bg-slate-900 border-t border-slate-700 print-hidden">
            <button onclick="window.print()" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg font-bold text-lg hover:from-blue-500 hover:to-indigo-500 transition-all shadow-lg flex items-center justify-center gap-2 transform hover:-translate-y-0.5">
                <i class="fa-solid fa-download"></i> Scarica PDF
            </button>
        </div>
    </div>

    <!-- PREVIEW (DESTRA) -->
    <div id="preview-container" class="flex-1 bg-slate-100 relative overflow-hidden flex justify-center items-start pt-10 px-4 print-hidden">
        
        <!-- Zoom Badge -->
        <div class="absolute top-4 right-4 bg-slate-800/80 text-white text-xs font-medium px-3 py-1.5 rounded-full backdrop-blur-sm shadow-sm flex items-center gap-2 z-10">
            <i class="fa-solid fa-magnifying-glass text-slate-400"></i> <span id="zoom-level">100%</span>
        </div>

        <!-- CV CONTAINER (A4) -->
        <div id="cv-render-target" class="bg-white text-slate-900">
            <!-- Il contenuto del CV viene iniettato qui da JS -->
        </div>

    </div>

</div>

<!-- LOGICA JS -->
<script>
    const cvApp = {
        data: {
            personal: { name: 'Mario Rossi', title: 'Digital Marketing Manager', email: 'mario.rossi@email.it', phone: '333 1234567', location: 'Milano, Italia', summary: 'Professionista con oltre 5 anni di esperienza nella gestione di campagne digitali e team creativi. Appassionato di dati, ROI e strategie di crescita innovative.' },
            experience: [{ id: 1, role: 'Senior Manager', company: 'Tech Solutions', start: '2020', end: 'Oggi', desc: 'Gestione budget 50k/mese. Coordinamento team di 5 persone.' }],
            education: [{ id: 1, degree: 'Laurea in Economia', school: 'Università Bocconi', year: '2019' }],
            skills: 'SEO, SEM, Google Analytics, Leadership, Inglese C1',
            photo: null,
            config: { template: 'sidebarLeft', color: '#2563eb', font: 'Inter, sans-serif', scale: 1, sidebarBg: '#1e293b', textColor: '#1e293b' }
        },
        
        init: function() {
            this.loadData();
            this.bindInputEvents();
            this.renderLists();
            this.updatePhotoPreview();
            this.render();
            
            // Auto-Zoom (Responsive)
            const observer = new ResizeObserver(() => this.autoScale());
            const container = document.getElementById('preview-container');
            if(container) observer.observe(container);
            setTimeout(() => this.autoScale(), 200);
        },

        // --- GESTIONE DATI ---
        loadData: function() {
            const saved = localStorage.getItem('cv_plat_js_v2');
            if (saved) {
                try {
                    const loaded = JSON.parse(saved);
                    this.data = {...this.data, ...loaded, config: {...this.data.config, ...loaded.config}};
                } catch(e) {}
            }
        },
        saveData: function() { localStorage.setItem('cv_plat_js_v2', JSON.stringify(this.data)); },
        resetData: function() {
            if(confirm('Cancellare tutto?')) {
                localStorage.removeItem('cv_plat_js_v2');
                location.reload();
            }
        },

        bindInputEvents: function() {
            document.querySelectorAll('[data-model]').forEach(input => {
                const [p, k] = input.getAttribute('data-model').split('.');
                input.value = k ? (this.data[p][k] || '') : (this.data[p] || '');
                
                input.oninput = (e) => {
                    if (k) this.data[p][k] = e.target.value;
                    else this.data[p] = e.target.value;
                    this.saveData(); this.render();
                };
            });
        },

        setConfig: function(k, v) { this.data.config[k] = v; this.saveData(); this.render(); },
        setLayout: function(tpl, btn) {
            this.data.config.template = tpl;
            document.querySelectorAll('.tpl-card').forEach(b => {
                b.classList.remove('active', 'border-blue-500', 'text-white');
                b.classList.add('border-transparent', 'text-slate-400');
            });
            btn.classList.add('active', 'border-blue-500', 'text-white');
            this.saveData(); this.render();
        },

        // --- LISTE ---
        addItem: function(type) {
            const item = type === 'experience' 
                ? { id: Date.now(), role: 'Ruolo', company: 'Azienda', start: '', end: '', desc: '' }
                : { id: Date.now(), degree: 'Titolo', school: 'Istituto', year: '' };
            this.data[type].unshift(item);
            this.saveData(); this.renderLists(); this.render();
        },
        removeItem: function(type, id) {
            if(confirm('Rimuovere?')) {
                this.data[type] = this.data[type].filter(i => i.id !== id);
                this.saveData(); this.renderLists(); this.render();
            }
        },
        updateList: function(type, id, key, val) {
            const item = this.data[type].find(i => i.id === id);
            if(item) item[key] = val;
            this.saveData(); this.render();
        },
        renderLists: function() {
            document.getElementById('list-experience').innerHTML = this.data.experience.map(i => `
                <div class="bg-slate-800 p-3 rounded border border-slate-700 relative group">
                    <button onclick="cvApp.removeItem('experience', ${i.id})" class="absolute top-2 right-2 text-slate-500 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                    <input class="bg-transparent text-white font-bold w-full mb-1 text-sm focus:outline-none" value="${i.role}" oninput="cvApp.updateList('experience', ${i.id}, 'role', this.value)" placeholder="Ruolo">
                    <input class="bg-transparent text-slate-400 w-full text-xs mb-2 focus:outline-none" value="${i.company}" oninput="cvApp.updateList('experience', ${i.id}, 'company', this.value)" placeholder="Azienda">
                    <div class="flex gap-2 mb-2">
                        <input class="bg-slate-700 text-white rounded text-xs p-1 w-1/2 focus:outline-none" value="${i.start}" oninput="cvApp.updateList('experience', ${i.id}, 'start', this.value)" placeholder="Dal">
                        <input class="bg-slate-700 text-white rounded text-xs p-1 w-1/2 focus:outline-none" value="${i.end}" oninput="cvApp.updateList('experience', ${i.id}, 'end', this.value)" placeholder="Al">
                    </div>
                    <textarea class="bg-slate-700 text-white rounded text-xs p-2 w-full resize-none focus:outline-none" rows="2" oninput="cvApp.updateList('experience', ${i.id}, 'desc', this.value)" placeholder="Descrizione...">${i.desc}</textarea>
                </div>
            `).join('');
            
            document.getElementById('list-education').innerHTML = this.data.education.map(i => `
                <div class="bg-slate-800 p-3 rounded border border-slate-700 relative group">
                    <button onclick="cvApp.removeItem('education', ${i.id})" class="absolute top-2 right-2 text-slate-500 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                    <input class="bg-transparent text-white font-bold w-full mb-1 text-sm focus:outline-none" value="${i.degree}" oninput="cvApp.updateList('education', ${i.id}, 'degree', this.value)" placeholder="Titolo">
                    <input class="bg-transparent text-slate-400 w-full text-xs mb-2 focus:outline-none" value="${i.school}" oninput="cvApp.updateList('education', ${i.id}, 'school', this.value)" placeholder="Istituto">
                    <input class="bg-slate-700 text-white rounded text-xs p-1 w-full focus:outline-none" value="${i.year}" oninput="cvApp.updateList('education', ${i.id}, 'year', this.value)" placeholder="Anno">
                </div>
            `).join('');
        },

        // --- FOTO ---
        uploadPhoto: function(el) {
            const file = el.files[0];
            if(file) {
                const r = new FileReader();
                r.onload = (e) => { this.data.photo = e.target.result; this.saveData(); this.updatePhotoPreview(); this.render(); };
                r.readAsDataURL(file);
            }
        },
        removePhoto: function() { this.data.photo = null; this.saveData(); this.updatePhotoPreview(); this.render(); },
        updatePhotoPreview: function() {
            const div = document.getElementById('preview-photo');
            div.innerHTML = this.data.photo ? `<img src="${this.data.photo}" class="w-full h-full object-cover">` : `<i class="fa-solid fa-user text-slate-500 text-2xl"></i>`;
        },

        // --- RENDER CV HTML ---
        render: function() {
            const d = this.data;
            const c = d.config;
            const target = document.getElementById('cv-render-target');
            
            // Imposta variabili CSS
            target.style.setProperty('--color-primary', c.color);
            target.style.setProperty('--color-side-bg', c.sidebarBg);
            target.style.setProperty('--color-side-text', '#ffffff');
            target.style.setProperty('--color-text', c.textColor);
            target.style.fontFamily = c.font;
            target.style.fontSize = `${14 * c.scale}px`;

            let html = '';
            
            // 1. MODERN (Sidebar Left)
            if (c.template === 'sidebarLeft') {
                html = `
                <div class="flex h-full">
                    <div class="w-[35%] bg-[var(--color-side-bg)] text-[var(--color-side-text)] p-8 flex flex-col print:w-[35%] print:h-full">
                        <div class="text-center mb-8">
                            ${d.photo ? `<div class="w-32 h-32 mx-auto mb-4 rounded-full bg-cover bg-center border-4 border-white/20" style="background-image:url('${d.photo}')"></div>` : `<div class="w-24 h-24 mx-auto mb-4 rounded-full bg-white/20 flex items-center justify-center text-3xl font-bold">${d.personal.name.charAt(0)}</div>`}
                            <h1 class="text-2xl font-bold leading-tight mb-2 break-words text-white">${d.personal.name}</h1>
                            <p class="opacity-80 text-sm uppercase tracking-wider text-white">${d.personal.title}</p>
                        </div>
                        <div class="space-y-3 text-sm mb-8 opacity-90 text-white">
                            <div class="flex items-center gap-3"><i class="fa-solid fa-envelope w-4"></i> <span class="break-all">${d.personal.email}</span></div>
                            <div class="flex items-center gap-3"><i class="fa-solid fa-phone w-4"></i> ${d.personal.phone}</div>
                            <div class="flex items-center gap-3"><i class="fa-solid fa-location-dot w-4"></i> ${d.personal.location}</div>
                        </div>
                        <div class="mt-auto">
                            <h3 class="text-xs font-bold uppercase tracking-widest border-b border-white/20 pb-2 mb-3 text-white opacity-80">Skills</h3>
                            <div class="flex flex-wrap gap-2 text-white">
                                ${d.skills.split(',').filter(s=>s.trim()).map(s => `<span class="bg-white/10 px-2 py-1 rounded text-xs">${s.trim()}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="w-[65%] p-10 bg-white text-[var(--color-text)]">
                        <section class="mb-8">
                            <h3 class="uppercase text-lg font-bold border-b-2 pb-2 mb-4 tracking-widest text-[var(--color-primary)]" style="border-color: color-mix(in srgb, var(--color-primary), white 80%);">Profilo</h3>
                            <p class="opacity-80 text-justify leading-relaxed">${d.personal.summary}</p>
                        </section>
                        <section class="mb-8">
                            <h3 class="uppercase text-lg font-bold border-b-2 pb-2 mb-6 tracking-widest text-[var(--color-primary)]" style="border-color: color-mix(in srgb, var(--color-primary), white 80%);">Esperienza</h3>
                            <div class="space-y-6">
                                ${d.experience.map(e => `
                                    <div class="relative pl-4 border-l-2 border-slate-200">
                                        <div class="absolute -left-[5px] top-1.5 w-2 h-2 rounded-full bg-[var(--color-primary)]"></div>
                                        <div class="flex justify-between items-baseline mb-1">
                                            <h4 class="font-bold text-lg">${e.role}</h4>
                                            <span class="text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-600">${e.start} - ${e.end}</span>
                                        </div>
                                        <div class="text-sm font-bold mb-2 text-[var(--color-primary)]">${e.company}</div>
                                        <p class="opacity-80 text-sm whitespace-pre-line">${e.desc}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </section>
                        <section>
                            <h3 class="uppercase text-lg font-bold border-b-2 pb-2 mb-6 tracking-widest text-[var(--color-primary)]" style="border-color: color-mix(in srgb, var(--color-primary), white 80%);">Formazione</h3>
                            <div class="space-y-4">
                                ${d.education.map(e => `<div><div class="font-bold">${e.degree}</div><div class="text-sm opacity-70">${e.school}, ${e.year}</div></div>`).join('')}
                            </div>
                        </section>
                    </div>
                </div>`;
            } 
            // 2. CLASSIC
            else if (c.template === 'classic') {
                html = `
                <div class="p-12 h-full bg-white text-[var(--color-text)]">
                    <div class="text-center border-b-2 border-slate-800 pb-8 mb-8">
                        <h1 class="text-4xl font-bold uppercase tracking-wide mb-2">${d.personal.name}</h1>
                        <p class="text-xl font-medium mb-4 text-[var(--color-primary)]">${d.personal.title}</p>
                        <div class="flex justify-center gap-4 text-sm opacity-70 flex-wrap">
                            <span>${d.personal.email}</span><span>•</span><span>${d.personal.phone}</span><span>•</span><span>${d.personal.location}</span>
                        </div>
                    </div>
                    <section class="mb-8">
                        <h3 class="uppercase font-bold text-lg border-b mb-4 pb-1 text-[var(--color-primary)] border-slate-200">Profilo</h3>
                        <p class="opacity-80 leading-relaxed">${d.personal.summary}</p>
                    </section>
                    <section class="mb-8">
                        <h3 class="uppercase font-bold text-lg border-b mb-6 pb-1 text-[var(--color-primary)] border-slate-200">Esperienza</h3>
                        ${d.experience.map(e => `
                            <div class="grid grid-cols-[1fr_3fr] gap-6 mb-6">
                                <div class="text-right text-sm font-bold opacity-60 pt-1">${e.start} - ${e.end}</div>
                                <div>
                                    <h4 class="font-bold text-lg">${e.role}</h4>
                                    <div class="text-sm italic mb-2 text-[var(--color-primary)]">${e.company}</div>
                                    <p class="opacity-80 text-sm">${e.desc}</p>
                                </div>
                            </div>
                        `).join('')}
                    </section>
                    <div class="flex gap-8">
                        <section class="flex-1">
                            <h3 class="uppercase font-bold text-lg border-b mb-4 pb-1 text-[var(--color-primary)] border-slate-200">Istruzione</h3>
                            ${d.education.map(e => `<div class="mb-4"><div class="font-bold">${e.degree}</div><div class="text-sm opacity-70">${e.school}, ${e.year}</div></div>`).join('')}
                        </section>
                        <section class="flex-1">
                            <h3 class="uppercase font-bold text-lg border-b mb-4 pb-1 text-[var(--color-primary)] border-slate-200">Skills</h3>
                            <p class="opacity-80 text-sm">${d.skills}</p>
                        </section>
                    </div>
                </div>`;
            }
            // 3. MINIMAL
            else {
                html = `
                <div class="p-12 h-full bg-white text-[var(--color-text)] grid grid-cols-[2fr_1fr] gap-12">
                    <div>
                        <h1 class="text-5xl font-light mb-2 leading-none">${d.personal.name}</h1>
                        <p class="text-lg uppercase tracking-widest font-bold mb-10 text-[var(--color-primary)]">${d.personal.title}</p>
                        <div class="mb-10 pl-6 border-l-4" style="border-color: var(--color-primary)">
                            <p class="italic opacity-80">${d.personal.summary}</p>
                        </div>
                        <section>
                            <h3 class="text-sm font-bold uppercase opacity-50 tracking-widest mb-6">Esperienza</h3>
                            <div class="space-y-8">
                                ${d.experience.map(e => `
                                    <div>
                                        <h4 class="text-xl font-bold">${e.role}</h4>
                                        <div class="text-sm font-bold mb-2 mt-1 text-[var(--color-primary)]">${e.company}</div>
                                        <p class="opacity-80 text-sm leading-relaxed">${e.desc}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </section>
                    </div>
                    <div class="text-right pt-2">
                        ${d.photo ? `<div class="w-32 h-32 ml-auto mb-8 bg-cover bg-center grayscale" style="background-image: url('${d.photo}')"></div>` : ''}
                        <div class="mb-10 space-y-2 text-sm">
                            <h3 class="text-xs font-bold uppercase opacity-50 tracking-widest mb-3">Contatti</h3>
                            <div class="font-medium break-all">${d.personal.email}</div>
                            <div class="font-medium">${d.personal.phone}</div>
                            <div class="font-medium">${d.personal.location}</div>
                        </div>
                        <div class="mb-10">
                            <h3 class="text-xs font-bold uppercase opacity-50 tracking-widest mb-4 border-b pb-2">Istruzione</h3>
                            ${d.education.map(e => `<div class="mb-4"><div class="font-bold">${e.degree}</div><div class="text-xs opacity-60">${e.school}</div><div class="text-xs opacity-40">${e.year}</div></div>`).join('')}
                        </div>
                        <div>
                            <h3 class="text-xs font-bold uppercase opacity-50 tracking-widest mb-4 border-b pb-2">Skills</h3>
                            <div class="flex flex-wrap justify-end gap-2">
                                ${d.skills.split(',').filter(s=>s.trim()).map(s => `<span class="border px-2 py-1 text-xs opacity-70 border-slate-300">${s.trim()}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>`;
            }
            
            target.innerHTML = html;
        },

        autoScale: function() {
            const container = document.getElementById('preview-container');
            const page = document.getElementById('cv-render-target');
            if(!container || !page) return;
            const availW = container.clientWidth - 32;
            const scale = Math.min(availW / 794, 1); // 794px = 210mm @ 96dpi
            page.style.transform = `scale(${scale})`;
            page.style.marginBottom = `-${1123 - (1123 * scale)}px`; // Compensate whitespace
            document.getElementById('zoom-level').innerText = `${Math.round(scale*100)}%`;
        },

        switchTab: function(t, btn) {
            document.querySelectorAll('#tab-content, #tab-design').forEach(b => {
                b.classList.remove('bg-slate-700', 'text-white');
                b.classList.add('text-slate-400', 'hover:text-white');
            });
            btn.classList.remove('text-slate-400', 'hover:text-white');
            btn.classList.add('bg-slate-700', 'text-white');
            document.getElementById('panel-content').style.display = t === 'content' ? 'block' : 'none';
            document.getElementById('panel-design').style.display = t === 'design' ? 'block' : 'none';
        }
    };

    document.addEventListener('DOMContentLoaded', () => cvApp.init());
</script>

</body>
</html>
